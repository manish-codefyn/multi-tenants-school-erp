document.addEventListener('DOMContentLoaded', function() {
    const sidebar = document.getElementById('sidebar');
    const mainToggleBtn = document.getElementById('main-toggle-btn');
    const sidebarCloseBtn = document.getElementById('sidebar-close');
    const body = document.body;
    const themeToggleBtn = document.getElementById('theme-toggle');
    const notificationsBtn = document.getElementById('notifications-btn');
    
    // Stat card elements for SweetAlert2 integration
    const revenueCard = document.getElementById('revenue-card');
    const usersCard = document.getElementById('users-card');
    const ordersCard = document.getElementById('orders-card');
    const conversionCard = document.getElementById('conversion-card');
    
    // Card action buttons
    const chartInfoBtn = document.getElementById('chart-info-btn');
    const exportOrdersBtn = document.getElementById('export-orders-btn');
    const refreshActivityBtn = document.getElementById('refresh-activity-btn');

    // Define the screen size breakpoint (must match CSS @media queries)
    const BREAKPOINT = 992; 

    function handleSidebarToggle() {
        const screenWidth = window.innerWidth;
        
        if (screenWidth <= BREAKPOINT) {
            // **SMALL SCREEN LOGIC (Mobile): Toggle to hide/show**
            // Toggles the 'active' class on the sidebar (CSS handles the slide-in/out)
            sidebar.classList.toggle('active');
            
            // Ensure desktop class is removed
            body.classList.remove('icon-only');

        } else {
            // **LARGE SCREEN LOGIC (Desktop): Toggle to full/icon view**
            // Toggles the 'icon-only' class on the body (CSS handles the width change)
            body.classList.toggle('icon-only');
            
            // Ensure mobile class is removed
            sidebar.classList.remove('active');
        }
    }

    // Close sidebar function for mobile
    function closeSidebar() {
        sidebar.classList.remove('active');
    }

    // 1. Add event listener for the main toggle button
    if (mainToggleBtn) {
        mainToggleBtn.addEventListener('click', handleSidebarToggle);
    }

    // 2. Add event listener for the sidebar close button (mobile)
    if (sidebarCloseBtn) {
        sidebarCloseBtn.addEventListener('click', closeSidebar);
    }

    // 3. Add event listener to check state on screen resize
    window.addEventListener('resize', () => {
         const screenWidth = window.innerWidth;
         
         // If resizing from large to small, remove the icon-only class
         if (screenWidth <= BREAKPOINT) {
            body.classList.remove('icon-only');
         } else {
            // If resizing from small to large, remove the mobile active class
            sidebar.classList.remove('active');
         }
    });
    
    // Dark/Light Mode Toggle
    if (themeToggleBtn) {
        themeToggleBtn.addEventListener('click', function() {
            document.body.classList.toggle('light-mode');
            const isLightMode = document.body.classList.contains('light-mode');
            const icon = this.querySelector('i');
            
            // Toggle the icon for the opposite mode
            if (isLightMode) {
                icon.classList.remove('fa-sun');
                icon.classList.add('fa-moon');
            } else {
                icon.classList.remove('fa-moon');
                icon.classList.add('fa-sun');
            }
        });
    }
    
    // Notifications with SweetAlert2
    if (notificationsBtn) {
        notificationsBtn.addEventListener('click', function() {
            Swal.fire({
                title: 'Notifications',
                html: `
                    <div style="text-align: left;">
                        <div style="padding: 10px 0; border-bottom: 1px solid #eee;">
                            <strong>New Order Received</strong><br>
                            <small>Order #ORD-007 from Alex Johnson</small>
                        </div>
                        <div style="padding: 10px 0; border-bottom: 1px solid #eee;">
                            <strong>System Update Available</strong><br>
                            <small>Version 2.3.1 is ready to install</small>
                        </div>
                        <div style="padding: 10px 0;">
                            <strong>Weekly Report Generated</strong><br>
                            <small>Your performance report is ready</small>
                        </div>
                    </div>
                `,
                showCloseButton: true,
                showConfirmButton: false,
                width: 400,
                background: getComputedStyle(document.body).getPropertyValue('--bg-card'),
                color: getComputedStyle(document.body).getPropertyValue('--text-light')
            });
        });
    }
    
    // Stat Cards with SweetAlert2 Details
    if (revenueCard) {
        revenueCard.addEventListener('click', function() {
            Swal.fire({
                title: 'Revenue Details',
                html: `
                    <div style="text-align: left;">
                        <p><strong>Current Month:</strong> $24,580</p>
                        <p><strong>Previous Month:</strong> $21,850</p>
                        <p><strong>Growth:</strong> <span style="color: #00f080;">+12.5%</span></p>
                        <p><strong>Top Product:</strong> Premium Subscription</p>
                        <p><strong>Revenue Goal:</strong> $25,000 (98.3%)</p>
                    </div>
                `,
                icon: 'info',
                confirmButtonText: 'Close',
                background: getComputedStyle(document.body).getPropertyValue('--bg-card'),
                color: getComputedStyle(document.body).getPropertyValue('--text-light')
            });
        });
    }
    
    if (usersCard) {
        usersCard.addEventListener('click', function() {
            Swal.fire({
                title: 'User Analytics',
                html: `
                    <div style="text-align: left;">
                        <p><strong>Active Users:</strong> 3,248</p>
                        <p><strong>New Users (30 days):</strong> 542</p>
                        <p><strong>Growth Rate:</strong> <span style="color: #00f080;">+8.2%</span></p>
                        <p><strong>User Retention:</strong> 78.4%</p>
                        <p><strong>Top Region:</strong> North America (42%)</p>
                    </div>
                `,
                icon: 'info',
                confirmButtonText: 'Close',
                background: getComputedStyle(document.body).getPropertyValue('--bg-card'),
                color: getComputedStyle(document.body).getPropertyValue('--text-light')
            });
        });
    }
    
    if (ordersCard) {
        ordersCard.addEventListener('click', function() {
            Swal.fire({
                title: 'Order Statistics',
                html: `
                    <div style="text-align: left;">
                        <p><strong>Total Orders:</strong> 1,428</p>
                        <p><strong>Completed:</strong> 1,210 (84.7%)</p>
                        <p><strong>Pending:</strong> 158 (11.1%)</p>
                        <p><strong>Cancelled:</strong> 60 (4.2%)</p>
                        <p><strong>Average Order Value:</strong> $87.45</p>
                    </div>
                `,
                icon: 'info',
                confirmButtonText: 'Close',
                background: getComputedStyle(document.body).getPropertyValue('--bg-card'),
                color: getComputedStyle(document.body).getPropertyValue('--text-light')
            });
        });
    }
    
    if (conversionCard) {
        conversionCard.addEventListener('click', function() {
            Swal.fire({
                title: 'Conversion Metrics',
                html: `
                    <div style="text-align: left;">
                        <p><strong>Current Rate:</strong> 68.2%</p>
                        <p><strong>Previous Rate:</strong> 69.5%</p>
                        <p><strong>Change:</strong> <span style="color: #f72585;">-1.3%</span></p>
                        <p><strong>Industry Average:</strong> 62.8%</p>
                        <p><strong>Top Converting Source:</strong> Organic Search</p>
                    </div>
                `,
                icon: 'warning',
                confirmButtonText: 'View Details',
                background: getComputedStyle(document.body).getPropertyValue('--bg-card'),
                color: getComputedStyle(document.body).getPropertyValue('--text-light')
            });
        });
    }
    
    // Card action buttons with SweetAlert2
    if (chartInfoBtn) {
        chartInfoBtn.addEventListener('click', function() {
            Swal.fire({
                title: 'Sales Performance Info',
                text: 'This chart shows your sales performance over the selected period. Data updates in real-time.',
                icon: 'info',
                confirmButtonText: 'Got it',
                background: getComputedStyle(document.body).getPropertyValue('--bg-card'),
                color: getComputedStyle(document.body).getPropertyValue('--text-light')
            });
        });
    }
    
    if (exportOrdersBtn) {
        exportOrdersBtn.addEventListener('click', function() {
            Swal.fire({
                title: 'Export Orders',
                text: 'Your order data is being prepared for export...',
                icon: 'success',
                timer: 2000,
                showConfirmButton: false,
                background: getComputedStyle(document.body).getPropertyValue('--bg-card'),
                color: getComputedStyle(document.body).getPropertyValue('--text-light')
            });
        });
    }
    
    if (refreshActivityBtn) {
        refreshActivityBtn.addEventListener('click', function() {
            Swal.fire({
                title: 'Refreshing Activity',
                text: 'Loading latest activities...',
                icon: 'success',
                timer: 1500,
                showConfirmButton: false,
                background: getComputedStyle(document.body).getPropertyValue('--bg-card'),
                color: getComputedStyle(document.body).getPropertyValue('--text-light')
            });
        });
    }
    
    // Add fade-in animation to elements on page load
    const elements = document.querySelectorAll('.fade-in');
    elements.forEach((el, index) => {
        el.style.animationDelay = `${index * 0.1}s`;
    });
});

        // Toggle sidebar
        document.getElementById('main-toggle-btn').addEventListener('click', function() {
            document.querySelector('.app-container').classList.toggle('icon-only');
        });

        // Toggle account dropdown
        document.getElementById('user-menu').addEventListener('click', function(e) {
            e.stopPropagation();
            this.classList.toggle('active');
        });

        // Close dropdown when clicking outside
        document.addEventListener('click', function() {
            document.getElementById('user-menu').classList.remove('active');
        });
