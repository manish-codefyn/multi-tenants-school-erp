{% extends 'layouts/dashboard.html' %}
{% load static %}

{% block title %}User Form{% endblock %}

{% block content %}

<div class="page-breadcrumb d-none d-sm-flex align-items-center mb-3">
    <div class="breadcrumb-title pe-3">Users</div>
    <div class="ps-3">
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb mb-0 p-0">
                <li class="breadcrumb-item">
                    <a href="{% url 'dashboard_redirect' %}">
                        <i class="bx bx-home-alt"></i>
                    </a>
                </li>
                <li class="breadcrumb-item">
                    <a href="{% url 'users:user_list' %}">Users</a>
                </li>
                <li class="breadcrumb-item active" aria-current="page">
                    {% if object %}Edit{% else %}Add{% endif %} User
                </li>
            </ol>
        </nav>
    </div>
</div>

<div class="row">
    <div class="col-xl-9 mx-auto">
        <div class="card">
            <div class="card-body">

                <h5 class="mb-4">User Details</h5>

                <form method="post" enctype="multipart/form-data" novalidate>
                    {% csrf_token %}

                    {% if form.non_field_errors %}
                    <div class="alert alert-danger">
                        {% for error in form.non_field_errors %}
                            {{ error }}
                        {% endfor %}
                    </div>
                    {% endif %}

                    <div class="row">
                        {% for field in form %}
                            <div class="col-md-6 mb-3">

                                <label class="form-label">
                                    {{ field.label }}
                                    {% if field.field.required %}
                                        <span class="text-danger">*</span>
                                    {% endif %}
                                </label>

                                {{ field }}

                                {% if field.errors %}
                                    <div class="text-danger small mt-1">
                                        {{ field.errors|striptags }}
                                    </div>
                                {% endif %}

                                {% if field.help_text %}
                                    <small class="form-text text-muted">
                                        {{ field.help_text }}
                                    </small>
                                {% endif %}

                            </div>

                            {% if forloop.counter|divisibleby:2 %}
                                </div><div class="row">
                            {% endif %}
                        {% endfor %}
                    </div>

                    <div class="d-grid gap-2 d-md-flex justify-content-md-end mt-4">
                        <button type="submit" class="btn btn-primary px-4">
                            Save Changes
                        </button>

                        <a href="{% url 'users:user_list' %}" class="btn btn-light px-4">
                            Cancel
                        </a>
                    </div>
                </form>

            </div>
        </div>
    </div>
</div>
{% endblock %}
{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const passwordFields = document.querySelectorAll('.password-toggle');
    passwordFields.forEach(field => {
        const toggleButton = document.createElement('button');
        toggleButton.type = 'button';
        toggleButton.className = 'btn btn-outline-secondary password-toggle-btn';
        toggleButton.innerHTML = '<i class="bi bi-eye"></i>';
        toggleButton.style.position = 'absolute';
        toggleButton.style.right = '10px';
        toggleButton.style.top = '50%';
        toggleButton.style.transform = 'translateY(-50%)';
        toggleButton.style.zIndex = '5';
        
        const parentDiv = field.parentElement;
        parentDiv.style.position = 'relative';
        parentDiv.appendChild(toggleButton);
        
        toggleButton.addEventListener('click', function() {
            const type = field.getAttribute('type') === 'password' ? 'text' : 'password';
            field.setAttribute('type', type);
            this.innerHTML = type === 'password' ? 
                '<i class="bi bi-eye"></i>' : 
                '<i class="bi bi-eye-slash"></i>';
        });
    });
});
</script>
{% endblock %}
