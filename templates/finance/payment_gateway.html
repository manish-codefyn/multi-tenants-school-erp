{% extends 'base.html' %}
{% load static %}

{% block title %}Payment Gateway{% endblock %}

{% block content %}
<div class="page-wrapper">
    <div class="page-content">
        <!--breadcrumb-->
        <div class="page-breadcrumb d-none d-sm-flex align-items-center mb-3">
            <div class="breadcrumb-title pe-3">Finance</div>
            <div class="ps-3">
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb mb-0 p-0">
                        <li class="breadcrumb-item"><a href="{% url 'finance:dashboard' %}"><i class="bx bx-home-alt"></i></a></li>
                        <li class="breadcrumb-item"><a href="{% url 'finance:my_invoices' %}">My Invoices</a></li>
                        <li class="breadcrumb-item active" aria-current="page">Pay Invoice {{ invoice.invoice_number }}</li>
                    </ol>
                </nav>
            </div>
        </div>
        <!--end breadcrumb-->

        <div class="row">
            <div class="col-xl-6 mx-auto">
                <div class="card border-top border-0 border-4 border-primary">
                    <div class="card-body p-5">
                        <div class="card-title d-flex align-items-center">
                            <div><i class="bx bx-credit-card me-1 font-22 text-primary"></i></div>
                            <h5 class="mb-0 text-primary">Secure Payment</h5>
                        </div>
                        <hr>
                        
                        <div class="d-flex justify-content-between mb-3">
                            <strong>Invoice Number:</strong>
                            <span>{{ invoice.invoice_number }}</span>
                        </div>
                        <div class="d-flex justify-content-between mb-3">
                            <strong>Student:</strong>
                            <span>{{ invoice.student }}</span>
                        </div>
                        <div class="d-flex justify-content-between mb-3">
                            <strong>Amount Due:</strong>
                            <span class="text-danger">₹{{ invoice.due_amount }}</span>
                        </div>
                         <div class="d-flex justify-content-between mb-4">
                            <strong>Payment Amount:</strong>
                            <span class="text-success h5">₹{{ invoice.due_amount }}</span>
                        </div>

                        <div class="d-grid gap-2">
                            <button id="rzp-button1" class="btn btn-primary btn-lg"><i class="bx bx-lock-alt"></i> Pay Now</button>
                            <a href="{% url 'finance:my_invoices' %}" class="btn btn-light btn-lg">Cancel</a>
                        </div>
                        
                        <div class="text-center mt-3">
                            <p class="text-muted"><small> <i class="bx bx-shield-quarter"></i> Secured by Razorpay</small></p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://checkout.razorpay.com/v1/checkout.js"></script>
<script>
var options = {
    "key": "{{ razorpay_merchant_key }}", // Enter the Key ID generated from the Dashboard
    "amount": "{{ razorpay_amount }}", // Amount is in currency subunits. Default currency is INR. Hence, 50000 refers to 50000 paise
    "currency": "{{ currency }}",
    "name": "{{ request.tenant.name|default:'EduERP' }}",
    "description": "Fee Payment for Invoice #{{ invoice.invoice_number }}",
    "image": "{% if request.tenant.logo %}{{ request.tenant.logo.url }}{% else %}{% static 'images/logo-icon.png' %}{% endif %}",
    "order_id": "{{ razorpay_order_id }}", //This is a sample Order ID. Pass the `id` obtained in the response of Step 1
    "callback_url": "{{ callback_url }}",
    "prefill": {
        "name": "{{ invoice.student.user.get_full_name }}",
        "email": "{{ invoice.student.user.email }}",
        "contact": "{{ invoice.student.user.phone_number }}"
    },
    "notes": {
        "address": "{{ invoice.student.address }}",
        "invoice_id": "{{ invoice.id }}"
    },
    "theme": {
        "color": "#3399cc"
    }
};

var rzp1 = new Razorpay(options);
document.getElementById('rzp-button1').onclick = function(e){
    rzp1.open();
    e.preventDefault();
}
</script>
{% endblock %}
