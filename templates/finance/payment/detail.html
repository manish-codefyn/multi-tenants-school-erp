{% extends 'layouts/dashboard.html' %}
{% load i18n humanize %}

{% block title %}{% trans "Payment Details" %}{% endblock %}

{% block content %}
    {% url 'finance:payment_list' as list_url %}
    {% include 'partials/breadcrumb.html' with page_title=_("Payment Details") current_text=_("Detail") parent_text=_("Payments") parent_url=list_url %}

    <div class="row g-4 justify-content-center">
        <div class="col-md-8">
            <div class="card border-0 shadow-sm">
                <div class="card-header bg-transparent border-0 d-flex justify-content-between align-items-center mt-2">
                    <h5 class="mb-0">{% trans "Transaction Info" %}</h5>
                    <div>
                         {% if payment.status == 'PENDING' %}
                         <form action="{% url 'finance:payment_verify' payment.pk %}" method="post" class="d-inline">
                            {% csrf_token %}
                             <button type="submit" class="btn btn-sm btn-success">
                                <i class='bx bx-check-double me-1'></i> {% trans "Verify Payment" %}
                            </button>
                         </form>
                        {% endif %}
                         <a href="{% url 'finance:payment_print' payment.pk %}?format=pdf" class="btn btn-sm btn-dark">
                            <i class='bx bx-download me-1'></i> {% trans "Download Receipt" %}
                        </a>
                    </div>
                </div>
                <div class="card-body">
                    <div class="text-center mb-4">
                        <div class="avatar avatar-lg bg-success-subtle text-success rounded-circle mx-auto mb-3 d-flex align-items-center justify-content-center" style="width: 60px; height: 60px;">
                            <i class='bx bx-check fs-2'></i>
                        </div>
                        <h3 class="fw-bold">â‚¹{{ payment.amount|intcomma }}</h3>
                        <p class="text-muted">{{ payment.transaction_id }}</p>
                         <span class="badge 
                            {% if payment.status == 'COMPLETED' %}bg-success
                            {% elif payment.status == 'PENDING' %}bg-warning
                            {% else %}bg-danger{% endif %} rounded-pill px-3">
                            {{ payment.get_status_display }}
                        </span>
                    </div>

                    <div class="row g-3">
                        <div class="col-md-6">
                            <label class="small text-muted text-uppercase fw-bold">{% trans "Student" %}</label>
                            <p class="fw-semibold">{{ payment.invoice.student.full_name }}</p>
                        </div>
                         <div class="col-md-6 text-end">
                            <label class="small text-muted text-uppercase fw-bold">{% trans "Invoice" %}</label>
                            <p class="fw-semibold">
                                <a href="{% url 'finance:invoice_detail' payment.invoice.pk %}">#{{ payment.invoice.invoice_number }}</a>
                            </p>
                        </div>
                        <div class="col-md-6">
                            <label class="small text-muted text-uppercase fw-bold">{% trans "Payment Date" %}</label>
                            <p>{{ payment.payment_date|date:"F d, Y h:i A" }}</p>
                        </div>
                        <div class="col-md-6 text-end">
                            <label class="small text-muted text-uppercase fw-bold">{% trans "Method" %}</label>
                            <p>{{ payment.get_payment_method_display }}</p>
                        </div>
                    </div>
                    
                    <hr>

                    <div class="row g-3">
                        <div class="col-md-6">
                            <label class="small text-muted text-uppercase fw-bold">{% trans "Received By" %}</label>
                            <p>{{ payment.received_by.get_full_name|default:"System" }}</p>
                        </div>
                         {% if payment.reference_number %}
                         <div class="col-md-6 text-end">
                            <label class="small text-muted text-uppercase fw-bold">{% trans "Reference No." %}</label>
                            <p>{{ payment.reference_number }}</p>
                        </div>
                        {% endif %}
                    </div>
                    
                    {% if payment.notes %}
                    <div class="mt-3">
                        <label class="small text-muted text-uppercase fw-bold">{% trans "Notes" %}</label>
                        <p class="text-muted fst-italic">{{ payment.notes }}</p>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
{% endblock %}
