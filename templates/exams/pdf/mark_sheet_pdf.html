<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Mark Sheet - {{ result.student }}</title>
    <style>
        @page {
            size: A4;
            margin: 1cm;
        }
        body {
            font-family: Arial, sans-serif;
            font-size: 10pt;
            color: #333;
        }
        .header {
            text-align: center;
            border-bottom: 2px solid #6a11cb;
            padding-bottom: 15px;
            margin-bottom: 20px;
        }
        .school-name {
            font-size: 22pt;
            font-weight: bold;
            color: #6a11cb;
            margin: 0;
            text-transform: uppercase;
        }
        .school-info {
            color: #666;
            margin: 5px 0;
        }
        .document-title {
            text-align: center;
            font-size: 16pt;
            font-weight: bold;
            margin: 20px 0;
            text-transform: uppercase;
            text-decoration: underline;
        }
        .info-table {
            width: 100%;
            margin-bottom: 20px;
        }
        .info-table td {
            padding: 5px;
            vertical-align: top;
        }
        .label {
            font-weight: bold;
            color: #555;
            width: 150px;
        }
        .marks-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 30px;
        }
        .marks-table th, .marks-table td {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: center;
        }
        .marks-table th {
            background-color: #f2f2f2;
            font-weight: bold;
        }
        .marks-table td.subject-name {
            text-align: left;
            font-weight: bold;
        }
        .total-row {
            background-color: #f9f9f9;
            font-weight: bold;
        }
        .summary-box {
            border: 1px solid #ddd;
            padding: 15px;
            margin-top: 20px;
        }
        .summary-table {
            width: 100%;
        }
        .summary-table td {
            padding: 5px 0;
        }
        .status-pass {
            color: green;
            font-weight: bold;
        }
        .status-fail {
            color: red;
            font-weight: bold;
        }
        .footer {
            margin-top: 50px;
        }
        .signature-box {
            float: right;
            width: 200px;
            text-align: center;
            border-top: 1px solid #333;
            padding-top: 5px;
        }
        .qrcode {
            float: left;
            width: 100px;
        }
        .verification {
            clear: both;
            text-align: center;
            font-size: 8pt;
            color: #888;
            margin-top: 30px;
            border-top: 1px solid #eee;
            padding-top: 10px;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1 class="school-name">{{ tenant.name }}</h1>
        <p class="school-info">{{ tenant.address|default:"" }}</p>
        <p class="school-info">Academic Session: {{ result.exam.academic_year.name }}</p>
    </div>

    <div class="document-title">Progress Report / Mark Sheet</div>

    <table class="info-table">
        <tr>
            <td class="label">Student Name:</td>
            <td>{{ result.student.first_name }} {{ result.student.last_name }}</td>
            <td class="label">Exam Name:</td>
            <td>{{ result.exam.name }}</td>
        </tr>
        <tr>
            <td class="label">Roll Number:</td>
            <td>{{ result.student.roll_number }}</td>
            <td class="label">Exam Type:</td>
            <td>{{ result.exam.exam_type.name }}</td>
        </tr>
        <tr>
            <td class="label">Class & Section:</td>
            <td>{{ result.student.current_class.name }} - {{ result.student.current_section.name }}</td>
            <td class="label">Date of Issue:</td>
            <td>{{ result.updated_at|date:"d M Y" }}</td>
        </tr>
    </table>

    <table class="marks-table">
        <thead>
            <tr>
                <th>Subject</th>
                <th>Max Marks</th>
                <th>Theory</th>
                <th>Practical</th>
                <th>Total Obtained</th>
                <th>Grade</th>
            </tr>
        </thead>
        <tbody>
            {% for subject in subject_results %}
            <tr>
                <td class="subject-name">{{ subject.exam_subject.subject.name }}</td>
                <td>{{ subject.exam_subject.max_marks }}</td>
                <td>{{ subject.theory_marks|default:"-" }}</td>
                <td>{{ subject.practical_marks|default:"-" }}</td>
                <td>{{ subject.total_marks_obtained }}</td>
                <td>{{ subject.grade.name|default:"-" }}</td>
            </tr>
            {% endfor %}
        </tbody>
        <tfoot>
            <tr class="total-row">
                <td style="text-align: right;">GRAND TOTAL</td>
                <td>{{ result.total_max_marks }}</td>
                <td colspan="2"></td>
                <td>{{ result.total_marks_obtained }}</td>
                <td>{{ result.overall_grade.name|default:"-" }}</td>
            </tr>
        </tfoot>
    </table>

    <div class="summary-box">
        <table class="summary-table">
            <tr>
                <td width="30%"><strong>Final Percentage:</strong></td>
                <td>{{ result.percentage }}%</td>
            </tr>
            <tr>
                <td><strong>Class Rank:</strong></td>
                <td>#{{ result.rank }} of {{ result.total_students }} students</td>
            </tr>
            <tr>
                <td><strong>Result Status:</strong></td>
                <td class="{% if result.is_pass %}status-pass{% else %}status-fail{% endif %}">
                    {% if result.is_pass %}PASSED / PROMOTED{% else %}FAILED{% endif %}
                </td>
            </tr>
        </table>
    </div>

    <div class="footer">
        <div class="signature-box">
            Authorized Signature<br>
            <small>(Principal/Examination Head)</small>
        </div>
    </div>

    <div class="verification">
        Mark Sheet No: {{ result.mark_sheet.mark_sheet_number|default:"N/A" }} | 
        Verification Code: {{ result.mark_sheet.verification_code|default:"N/A" }}<br>
        Digitally generated by {{ tenant.name }} Management System
    </div>
</body>
</html>
