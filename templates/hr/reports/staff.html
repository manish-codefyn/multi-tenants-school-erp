{% extends 'layouts/dashboard.html' %}
{% load i18n static %}

{% block title %}{% trans "Staff Reports" %}{% endblock %}

{% block extra_css %}
<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1 class="h3 mb-0 text-gray-800">{% trans "Staff Analytical Reports" %}</h1>
        <a href="{% url 'hr:report_staff_pdf' %}" class="btn btn-primary no-print">
            <i class="bx bx-download me-2"></i>{% trans "Download PDF" %}
        </a>
    </div>

    <!-- Summary Cards -->
    <div class="row g-4 mb-4">
        <div class="col-xl-3 col-md-6">
            <div class="card border-0 shadow-sm border-start border-4 border-primary h-100">
                <div class="card-body">
                    <div class="text-xs font-weight-bold text-primary text-uppercase mb-1">{% trans "Total Staff" %}</div>
                    <div class="h3 mb-0 font-weight-bold text-gray-800">{{ total_staff }}</div>
                </div>
            </div>
        </div>
        {% for gender in gender_stats %}
        <div class="col-xl-3 col-md-6">
            <div class="card border-0 shadow-sm border-start border-4 border-info h-100">
                <div class="card-body">
                    <div class="text-xs font-weight-bold text-info text-uppercase mb-1">{{ gender.gender }}</div>
                    <div class="h3 mb-0 font-weight-bold text-gray-800">{{ gender.count }}</div>
                    <small class="text-muted">{{ gender.percentage|floatformat:1 }}%</small>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>

    <div class="row g-4">
        <!-- Department Distribution -->
        <div class="col-xl-6 col-lg-6">
            <div class="card border-0 shadow-sm h-100">
                <div class="card-header bg-transparent py-3">
                    <h6 class="m-0 font-weight-bold text-primary">{% trans "Staff by Department" %}</h6>
                </div>
                <div class="card-body">
                    <div style="height: 300px; position: relative;">
                        <canvas id="deptChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- Designation Distribution -->
        <div class="col-xl-6 col-lg-6">
            <div class="card border-0 shadow-sm h-100">
                <div class="card-header bg-transparent py-3">
                    <h6 class="m-0 font-weight-bold text-primary">{% trans "Staff by Designation" %}</h6>
                </div>
                <div class="card-body">
                    <div style="height: 300px; position: relative;">
                        <canvas id="desigChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- Age Distribution -->
        <div class="col-xl-6 col-lg-6">
            <div class="card border-0 shadow-sm h-100">
                <div class="card-header bg-transparent py-3">
                    <h6 class="m-0 font-weight-bold text-primary">{% trans "Age Distribution" %}</h6>
                </div>
                <div class="card-body">
                    <div style="height: 300px; position: relative;">
                        <canvas id="ageChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- Service Years -->
        <div class="col-xl-6 col-lg-6">
            <div class="card border-0 shadow-sm h-100">
                <div class="card-header bg-transparent py-3">
                    <h6 class="m-0 font-weight-bold text-primary">{% trans "Years of Service" %}</h6>
                </div>
                <div class="card-body">
                    <div style="height: 300px; position: relative;">
                        <canvas id="serviceChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Department Chart
    const deptCtx = document.getElementById('deptChart').getContext('2d');
    new Chart(deptCtx, {
        type: 'doughnut',
        data: {
            labels: [{% for stat in dept_stats %}"{{ stat.department }}",{% endfor %}],
            datasets: [{
                data: [{% for stat in dept_stats %}{{ stat.count }},{% endfor %}],
                backgroundColor: ['#4e73df', '#1cc88a', '#36b9cc', '#f6c23e', '#e74a3b', '#858796', '#5a5c69'],
            }]
        },
        options: { maintainAspectRatio: false }
    });

    // Designation Chart
    const desigCtx = document.getElementById('desigChart').getContext('2d');
    new Chart(desigCtx, {
        type: 'pie',
        data: {
            labels: [{% for stat in desig_stats %}"{{ stat.designation }}",{% endfor %}],
            datasets: [{
                data: [{% for stat in desig_stats %}{{ stat.count }},{% endfor %}],
                backgroundColor: ['#4e73df', '#1cc88a', '#36b9cc', '#f6c23e', '#e74a3b', '#858796', '#5a5c69'],
            }]
        },
        options: { maintainAspectRatio: false }
    });

    // Age Chart
    const ageCtx = document.getElementById('ageChart').getContext('2d');
    new Chart(ageCtx, {
        type: 'bar',
        data: {
            labels: [{% for group, count in age_groups.items %}"{{ group }}",{% endfor %}],
            datasets: [{
                label: "{% trans 'Staff Count' %}",
                data: [{% for group, count in age_groups.items %}{{ count }},{% endfor %}],
                backgroundColor: '#36b9cc',
            }]
        },
        options: { maintainAspectRatio: false, scales: { y: { beginAtZero: true } } }
    });

    // Service Chart
    const serviceCtx = document.getElementById('serviceChart').getContext('2d');
    new Chart(serviceCtx, {
        type: 'bar',
        data: {
            labels: [{% for group, count in service_years.items %}"{{ group }}",{% endfor %}],
            datasets: [{
                label: "{% trans 'Staff Count' %}",
                data: [{% for group, count in service_years.items %}{{ count }},{% endfor %}],
                backgroundColor: '#1cc88a',
            }]
        },
        options: { maintainAspectRatio: false, scales: { y: { beginAtZero: true } } }
    });
</script>
{% endblock %}
